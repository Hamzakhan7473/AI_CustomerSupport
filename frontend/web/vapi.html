<!DOCTYPE html>
<html>
  <head>
    <title>Vapi Voice Assistant</title>
    <meta charset="UTF-8" />
  </head>
  <body style="background-color: #000; color: #fff; font-family: sans-serif; padding: 2rem;">
    <h2 id="status">ğŸ”„ Connecting to Aven AI...</h2>
    <div id="transcript" style="margin-top: 2rem; font-size: 1.1rem;"></div>

    <script type="module">
      import Vapi from "https://esm.sh/@vapi-ai/web";

      const urlParams = new URLSearchParams(window.location.search);
      const assistantId = urlParams.get("assistantId") || urlParams.get("assistantid");
      const publicKey = urlParams.get("publicKey") || urlParams.get("publickey");

      const statusEl = document.getElementById("status");
      const transcriptEl = document.getElementById("transcript");

      console.log("ğŸ§ª assistantId:", assistantId);
      console.log("ğŸ§ª publicKey:", publicKey);

      if (!assistantId || !publicKey) {
        statusEl.innerHTML = "âŒ Missing assistantId or publicKey";
        throw new Error("Missing required query params");
      }

      const vapi = new Vapi({ apiKey: publicKey });

      try {
        vapi.start(assistantId);
      } catch (e) {
        console.error("âŒ Error starting Vapi:", e);
        statusEl.innerHTML = "âŒ Error starting Vapi";
      }

      vapi.on("call-start", () => {
        console.log("âœ… Call started");
        statusEl.innerHTML = "ğŸŸ¢ Connected â€” Youâ€™re now speaking with Aven AI";
      });

      vapi.on("call-end", () => {
        console.log("ğŸ“ Call ended");
        statusEl.innerHTML = "ğŸ”´ Call ended";
      });

      vapi.on("message", (msg) => {
        console.log("ğŸ§  Assistant said:", msg);
        const p = document.createElement("p");
        p.textContent = "ğŸ¤– " + msg;
        transcriptEl.appendChild(p);
      });

      vapi.on("error", (e) => {
        console.error("âŒ Error:", e);
        statusEl.innerHTML = "âŒ Call error: " + (e?.message || "Unknown error");
      });
    </script>
  </body>
</html>
